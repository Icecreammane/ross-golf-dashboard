# FitTrack Production Deployment Guide

**Goal:** Deploy FitTrack to Railway in 30 minutes this weekend

**Timeline:** Complete before Friday Feb 13, 7pm launch

---

## Prerequisites

‚úÖ GitHub repo created: `github.com/Icecreammane/fittrack-pro`  
‚úÖ Stripe account set up (test mode ‚Üí production mode transition)  
‚¨ú Railway account (create during this guide)

---

## Step 1: Create Railway Account (5 min)

1. **Visit Railway**
   - Go to: https://railway.app
   - Click "Start a New Project"

2. **Connect GitHub**
   - Click "Login with GitHub"
   - Authorize Railway to access your repositories
   - ‚úÖ Railway can now see `Icecreammane/fittrack-pro`

---

## Step 2: Deploy from GitHub (3 min)

1. **Create New Project**
   - Dashboard ‚Üí "New Project"
   - Select "Deploy from GitHub repo"
   - Choose: `Icecreammane/fittrack-pro`
   - Railway auto-detects: Python, Flask

2. **Initial Build**
   - Railway automatically starts building
   - Watch build logs in dashboard
   - Wait for: "Build successful" ‚úÖ

**What Railway Does Automatically:**
- Reads `requirements.txt` ‚Üí installs dependencies
- Detects Flask app
- Assigns internal port
- Creates PostgreSQL database (if needed)

---

## Step 3: Configure Environment Variables (10 min)

‚ö†Ô∏è **CRITICAL:** Without these, FitTrack won't work

1. **Open Variables Tab**
   - Project dashboard ‚Üí "Variables"
   - Click "New Variable"

2. **Add Each Variable:**

### Required Variables:

```bash
# Flask Configuration
FLASK_APP=app_saas.py
FLASK_ENV=production
SECRET_KEY=<GENERATE_RANDOM_32_CHARS>

# Stripe Keys (get from Stripe dashboard)
STRIPE_PUBLISHABLE_KEY=pk_live_xxxxxxxxxxxxx
STRIPE_SECRET_KEY=sk_live_xxxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxx

# Database (Railway provides automatically)
DATABASE_URL=postgresql://...  # Auto-generated by Railway
```

### Generate SECRET_KEY:

**Option 1 - Python:**
```bash
python3 -c "import secrets; print(secrets.token_urlsafe(32))"
```

**Option 2 - OpenSSL:**
```bash
openssl rand -base64 32
```

Copy output ‚Üí paste into Railway `SECRET_KEY` variable

### Get Stripe Keys:

1. **Stripe Dashboard:** https://dashboard.stripe.com
2. **Switch to Production Mode:** Toggle top-right (Test ‚Üí Live)
3. **Get Keys:**
   - Developers ‚Üí API Keys
   - Copy: `Publishable key` (starts with `pk_live_`)
   - Click "Reveal test key token" ‚Üí Copy `Secret key` (starts with `sk_live_`)
4. **Paste into Railway variables**

‚ö†Ô∏è **Important:** Use LIVE keys, not test keys (unless testing deployment first)

---

## Step 4: Generate Domain (2 min)

1. **Settings Tab**
   - Project ‚Üí Settings ‚Üí Domains
   - Click "Generate Domain"

2. **Get Your URL**
   - Railway assigns: `fittrack-pro.up.railway.app` (example)
   - **Copy this URL** ‚Üí You'll need it for Stripe webhooks

3. **Visit URL**
   - Click generated domain
   - Should see FitTrack homepage
   - If errors ‚Üí check Railway logs tab

---

## Step 5: Configure Stripe Webhooks (5 min)

‚ö†Ô∏è **Without webhooks, subscriptions won't work**

1. **Stripe Dashboard**
   - Go to: https://dashboard.stripe.com/webhooks
   - Make sure you're in **LIVE mode** (top-right toggle)

2. **Add Endpoint**
   - Click "Add endpoint"
   - **Endpoint URL:** `https://[your-railway-url].up.railway.app/webhook/stripe`
   - Example: `https://fittrack-pro.up.railway.app/webhook/stripe`

3. **Select Events to Listen For**
   - Click "Select events"
   - Add these 4 events:
     - ‚úÖ `customer.subscription.created`
     - ‚úÖ `customer.subscription.deleted`
     - ‚úÖ `invoice.payment_succeeded`
     - ‚úÖ `invoice.payment_failed`
   - Click "Add events"

4. **Copy Webhook Secret**
   - Click "Add endpoint"
   - Stripe shows: `Signing secret` (starts with `whsec_`)
   - Click "Reveal" ‚Üí Copy entire secret
   - **Add to Railway:** Variables tab ‚Üí `STRIPE_WEBHOOK_SECRET`

5. **Test Webhook**
   - Stripe dashboard ‚Üí click your new webhook
   - Click "Send test webhook"
   - Select: `customer.subscription.created`
   - Click "Send test webhook"
   - ‚úÖ Should see "Response: 200 OK"

---

## Step 6: Verification Testing (5 min)

**Test every critical feature:**

### 1. Homepage Loads
- Visit: `https://[your-railway-url].up.railway.app`
- ‚úÖ Page loads without errors
- ‚úÖ CSS/styling looks correct

### 2. Sign Up Works
- Click "Sign Up"
- Create test account: `test@test.com` / password
- ‚úÖ Account created successfully
- ‚úÖ Redirects to dashboard

### 3. Food Logging Works
- Dashboard ‚Üí "Log Food"
- Add: Chicken Breast, 200g, 30P/0C/3F
- ‚úÖ Food saves
- ‚úÖ Macros update on dashboard

### 4. Workout Logging Works
- Dashboard ‚Üí "Log Workout"
- Add: Bench Press, 225lbs, 5x5
- ‚úÖ Workout saves
- ‚úÖ Shows in history

### 5. Stripe Checkout Works (Test Mode First)
- **Switch Stripe to TEST mode** for this test
- Update Railway variables:
  - `STRIPE_PUBLISHABLE_KEY=pk_test_...`
  - `STRIPE_SECRET_KEY=sk_test_...`
- Dashboard ‚Üí "Upgrade to Pro"
- Use test card: `4242 4242 4242 4242` / any future date / any CVC
- ‚úÖ Checkout completes
- ‚úÖ Redirects to success page
- ‚úÖ Account shows "Pro" status

### 6. Webhooks Fire Correctly
- Stripe dashboard ‚Üí Webhooks ‚Üí Your endpoint
- ‚úÖ Shows recent successful events (200 response)
- ‚úÖ `customer.subscription.created` fired
- Railway logs show webhook received

**After testing, switch back to LIVE Stripe keys!**

---

## Step 7: Custom Domain (Optional, 10 min)

**Skip this if launching with Railway URL (totally fine)**

### Buy Domain

1. **Namecheap:** https://www.namecheap.com
2. **Search:** `fittrack.app` or `simplefittrack.com`
3. **Purchase:** ~$12/year

### Connect to Railway

1. **Railway Dashboard**
   - Settings ‚Üí Domains ‚Üí "Custom Domain"
   - Enter: `fittrack.app`
   - Railway shows DNS records to add

2. **Namecheap DNS**
   - Dashboard ‚Üí Domain ‚Üí "Manage"
   - Advanced DNS ‚Üí Add records:
     - **A Record:** `@` ‚Üí Railway IP
     - **CNAME:** `www` ‚Üí Railway domain
   - (Railway provides exact values)

3. **Wait for DNS Propagation**
   - 5 minutes - 24 hours (usually ~10 min)
   - Test: `https://fittrack.app`

---

## Verification Checklist

Before launching Friday, verify:

- ‚úÖ Site loads at Railway URL
- ‚úÖ Sign up works
- ‚úÖ Login works
- ‚úÖ Food logging works
- ‚úÖ Workout logging works
- ‚úÖ Stripe checkout works (test mode verified)
- ‚úÖ Stripe LIVE keys configured
- ‚úÖ Webhooks fire correctly (200 responses)
- ‚úÖ Health check endpoint works (`/health`)
- ‚úÖ No errors in Railway logs
- ‚úÖ SSL/HTTPS working (Railway provides free)

---

## Common Issues & Fixes

### ‚ùå "Application failed to respond"
**Cause:** Port configuration  
**Fix:** Railway auto-sets `$PORT` env var. Make sure Flask uses it:
```python
if __name__ == '__main__':
    port = int(os.environ.get('PORT', 5000))
    app.run(host='0.0.0.0', port=port)
```

### ‚ùå Database connection errors
**Cause:** `DATABASE_URL` not set  
**Fix:** 
1. Railway ‚Üí "New" ‚Üí "Database" ‚Üí "PostgreSQL"
2. Railway auto-adds `DATABASE_URL` variable
3. Redeploy app

### ‚ùå Stripe errors: "No such customer"
**Cause:** Using test keys in production or vice versa  
**Fix:** 
- Verify Railway variables use `pk_live_` and `sk_live_` (not `pk_test_`)
- Stripe dashboard must be in LIVE mode

### ‚ùå Webhooks returning 404
**Cause:** Wrong endpoint URL  
**Fix:** 
- Verify Stripe webhook URL exactly matches: `https://[railway-url]/webhook/stripe`
- Check Flask route exists: `@app.route('/webhook/stripe', methods=['POST'])`

### ‚ùå Build fails: "requirements.txt not found"
**Cause:** Missing dependencies file  
**Fix:** 
- Ensure `requirements.txt` in repo root
- Should include: Flask, stripe, gunicorn, psycopg2-binary, etc.

### ‚ùå CSS/JS not loading
**Cause:** Static files not configured  
**Fix:**
```python
app = Flask(__name__, static_folder='static', static_url_path='/static')
```

---

## Cost Breakdown

| Service | Plan | Cost | Notes |
|---------|------|------|-------|
| **Railway** | Hobby | $5/month | First $5 free credit |
| **Domain** (optional) | Annual | $12/year | One-time/annual |
| **Stripe** | Pay-as-you-go | 2.9% + 30¬¢/transaction | Only pay on revenue |
| **Total Startup Cost** | | **~$5/month** | First month free with credit |

**At $3,000 MRR (300 customers @ $10/mo):**
- Railway: $5/month (may need to upgrade to Pro at $20/mo for scale)
- Stripe fees: ~$100/month (2.9% of $3,000)
- **Total costs: ~$105-120/month**
- **Net profit: ~$2,880/month**

---

## Post-Deployment

**After successful deployment:**

1. ‚úÖ Add Railway URL to `README.md`
2. ‚úÖ Set up monitoring (see `MONITORING_SETUP_GUIDE.md`)
3. ‚úÖ Test with real credit card (your own)
4. ‚úÖ Share URL with 10 friends for feedback
5. ‚úÖ Add URL to Twitter bio
6. ‚úÖ Update r/fitness launch post with URL

---

## Emergency Rollback

**If something breaks:**

1. **Railway Dashboard**
   - Deployments tab ‚Üí Previous deployment
   - Click "Redeploy"
   - Reverts to last working version

2. **Check Logs**
   - Railway ‚Üí Logs tab
   - Filter: "ERROR"
   - Identify issue

3. **Fix & Redeploy**
   - Fix issue in code
   - Push to GitHub
   - Railway auto-deploys

**Railway keeps last 10 deployments ‚Üí easy rollback**

---

## Launch Day Checklist (Feb 13)

**6:30pm - Pre-Launch:**
- ‚úÖ Visit Railway URL ‚Üí verify everything works
- ‚úÖ Test sign up flow (new account)
- ‚úÖ Test Stripe checkout (test mode, then verify LIVE keys active)
- ‚úÖ Check Railway logs (no errors)
- ‚úÖ Verify webhooks working (Stripe dashboard)

**7:00pm - Launch:**
- ‚úÖ Post Twitter announcement (with URL)
- ‚úÖ Post r/fitness (with URL)
- ‚úÖ Email early-access list (with URL)

**7:00pm-9:00pm - Monitor:**
- ‚úÖ Watch Railway logs for errors
- ‚úÖ Reply to every comment
- ‚úÖ Monitor signups in database
- ‚úÖ Watch Stripe dashboard for transactions

---

## Support

**If stuck:**
- Railway docs: https://docs.railway.app
- Railway Discord: https://discord.gg/railway
- Stripe docs: https://stripe.com/docs
- Ask Jarvis (me) for help debugging

---

**You got this. 30 minutes to live deployment. Let's go. üöÄ**
